<!DOCTYPE html>
<html>
<head>
    <title>Changeset Mover</title>

    <script type="text/javascript" src="/apps/2.0rc2/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("ChangesetMover",{extend:"Rally.app.App",componentCls:"app",items:[{xtype:"container",itemId:"labelContainer",html:"Find Changesets With Commit Timestamps Between:",padding:"10px"},{xtype:"container",itemId:"startDateTimeChooser",flex:1,layout:"hbox",padding:"10px"},{xtype:"container",itemId:"endDateTimeChooser",flex:1,layout:"hbox",padding:"10px"},{xtype:"container",itemId:"controlsContainer",columnWidth:1},{xtype:"container",itemId:"gridContainer",columnWidth:1}],_rallyServer:null,_startDateString:null,_endDateString:null,_startDateStringUTC:null,_endDateStringUTC:null,_startHourString:"00",_endHourString:"23",_startMinuteString:"00",_endMinuteString:"59",_startHourCombobox:null,_startMinuteCombobox:null,_startDateTextField:null,_startDateChooserDialog:null,_endHourCombobox:null,_endMinuteCombobox:null,_endDateTextField:null,_endDateChooserDialog:null,_startDateIsInFutureDialog:null,_startDateIsGTEndDateDialog:null,_findChangesetsButton:null,launch:function(){var me=this;me._getHostName(),me._initializeDefaultDates(),me._buildUI()},_buildUI:function(){console.log("_buildUI");var me=this,startDateText=me._startDateString;this._startDateTextField=Ext.create("Rally.ui.TextField",{fieldLabel:"Start Date",value:startDateText,listeners:{render:function(){this.getEl().on("mousedown",function(e,t,eOpts){me._createStartDateChooserDialog()})}}});var endDateText=me._endDateString;this._endDateTextField=Ext.create("Rally.ui.TextField",{fieldLabel:"End Date",value:endDateText,listeners:{render:function(){this.getEl().on("mousedown",function(e,t,eOpts){me._createEndDateChooserDialog()})}}});for(var hourData=[],i=0;23>=i;i++){var hourKeyAndValue=me._padIntegerToString(i,2),record={name:hourKeyAndValue,value:hourKeyAndValue};hourData.push(record)}var hourStore=Ext.create("Ext.data.Store",{fields:["name","value"],data:hourData});this._startHourCombobox=Ext.create("Ext.form.ComboBox",{fieldLabel:"Start Hour:",store:hourStore,queryMode:"local",displayField:"name",valueField:"value",value:hourStore.getAt(0).get("value"),listeners:{scope:this,select:function(combobox,records){me._startHourString=records[0].get("value")}}}),this._endHourCombobox=Ext.create("Ext.form.ComboBox",{fieldLabel:"End Hour:",store:hourStore,queryMode:"local",displayField:"name",valueField:"value",value:hourStore.getAt(23).get("value"),listeners:{scope:this,select:function(combobox,records){me._endHourString=records[0].get("value")}}});var minuteData=[];for(i=0;59>=i;i++){var minuteKeyAndValue=me._padIntegerToString(i,2),minuteRecord={name:minuteKeyAndValue,value:minuteKeyAndValue};minuteData.push(minuteRecord)}var minuteStore=Ext.create("Ext.data.Store",{fields:["name","value"],data:minuteData});this._startMinuteCombobox=Ext.create("Ext.form.ComboBox",{fieldLabel:"Start Minute:",store:minuteStore,queryMode:"local",displayField:"name",valueField:"value",value:minuteStore.getAt(0).get("value"),listeners:{scope:this,select:function(combobox,records){me._startMinuteString=records[0].getValue()}}}),this._endMinuteCombobox=Ext.create("Ext.form.ComboBox",{fieldLabel:"End Minute:",store:minuteStore,queryMode:"local",displayField:"name",valueField:"value",value:minuteStore.getAt(59).get("value"),listeners:{scope:this,select:function(combobox,records){me._endMinuteString=records[0].get("value")}}}),this.down("#startDateTimeChooser").add(this._startDateTextField),this.down("#startDateTimeChooser").add(this._startHourCombobox),this.down("#startDateTimeChooser").add(this._startMinuteCombobox),this.down("#endDateTimeChooser").add(this._endDateTextField),this.down("#endDateTimeChooser").add(this._endHourCombobox),this.down("#endDateTimeChooser").add(this._endMinuteCombobox),this._findChangesetsButton=Ext.create("Ext.Container",{items:[{xtype:"rallybutton",text:"Look For Changesets",handler:function(){me._validateTimebox()}}]}),this.down("#controlsContainer").add(this._findChangesetsButton)},_getHostName:function(){console.log("_getHostName"),testUrl=window.location.hostname||"rally1.rallydev.com",testUrlSplit=testUrl.split("/"),this._rallyHost=1===testUrlSplit.length?"rally1.rallydev.com":testUrlSplit[2],this._rallyServer="https://"+this._rallyHost},_initializeDefaultDates:function(){console.log("_initializeDefaultDates");var me=this;me._startDateString=me._dateToISOString(new Date,!1,!0),me._endDateString=me._dateToISOString(new Date,!1,!0)},_padIntegerToString:function(num,size){console.log("_padIntegerToString");for(var numToPad=Math.abs(num),paddedString=numToPad+"";size>paddedString.length;)paddedString="0"+paddedString;return num>=0?paddedString:"-"+paddedString},_createStartDateChooserDialog:function(){console.log("_createStartDateChooserDialog");var me=this;me._startDateChooserDialog&&me._startDateChooserDialog.destroy();var label="Choose Start Commit Date:",defaultDate=new Date,confirmLabel="Ok",maxDate=new Date;me._startDateChooserDialog=Ext.create("ChangesetMover.ChooseDateDialog",{calendarLabel:label,defaultDate:defaultDate,confirmLabel:confirmLabel,maxDate:maxDate,listeners:{confirm:function(dialog,chosendate){me._startDateString=me._dateToISOString(chosendate,!1,!0),me._startDateTextField.setValue(me._startDateString)}}})},_createEndDateChooserDialog:function(){console.log("_createEndDateChooserDialog");var me=this;me._endDateChooserDialog&&me._endDateChooserDialog.destroy();var label="Choose End Commit Date:",defaultDate=new Date,confirmLabel="Ok";me._endDateChooserDialog=Ext.create("ChangesetMover.ChooseDateDialog",{calendarLabel:label,defaultDate:defaultDate,confirmLabel:confirmLabel,listeners:{confirm:function(dialog,chosendate){me._endDateString=me._dateToISOString(chosendate,!1,!0),me._endDateTextField.setValue(me._endDateString)}}})},_validateTimebox:function(){console.log("_validateTimebox");var me=this,startDate_LocalTime_StringFormat=me._getDateStringWithUTCOffset(me._startDateString,me._startHourString,me._startMinuteString),endDate_LocalTime_StringFormat=me._getDateStringWithUTCOffset(me._endDateString,me._endHourString,me._endMinuteString),now=new Date,nowUTCString=me._dateToISOString(now,!0,!1),nowUTC=Rally.util.DateTime.fromIsoString(nowUTCString),startDateUTC=Rally.util.DateTime.fromIsoString(startDate_LocalTime_StringFormat),endDateUTC=Rally.util.DateTime.fromIsoString(endDate_LocalTime_StringFormat);if(startDateUTC>=nowUTC)return me._startDateIsInFutureNotify(),void 0;if(startDateUTC>=endDateUTC)return me._startDateIsGTEndDateNotify(),void 0;var startDateStringUTC=me._dateToISOString(startDateUTC,!0,!1),endDateStringUTC=me._dateToISOString(endDateUTC,!0,!1);me._startDateStringUTC=startDateStringUTC,me._endDateStringUTC=endDateStringUTC,me._hydrateData()},_dateToISOString:function(date,convertToUTC,stripTimePortion){return console.log("_dateToISOString"),stripTimePortion?Rally.util.DateTime.toIsoString(date,convertToUTC).replace(/T[\W\w]*/,""):Rally.util.DateTime.toIsoString(date,convertToUTC)},_getDateStringWithUTCOffset:function(dateString,hourString,minuteString){console.log("_getDateStringWithUTCOffset");var me=this,dateTimeSeparator="T",timeDelim=":",secondsString="00",offsetMinutesString="00",offsetHoursString=me._getUTCOffsetString();return dateString+dateTimeSeparator+hourString+timeDelim+minuteString+timeDelim+secondsString+offsetHoursString+timeDelim+offsetMinutesString},_getUTCOffsetString:function(){return console.log("_getUTCOffsetString"),this._padIntegerToString(parseInt(Ext.Date.format(new Date,"Z"),10)/3600,2)},_startDateIsInFutureNotify:function(){console.log("_startDateIsInFutureNotify");var me=this;me._startDateIsInFutureDialog&&me._startDateIsInFutureDialog.destroy(),me._startDateIsInFutureDialog=Ext.create("Rally.ui.dialog.ConfirmDialog",{title:"Start Date/Time is in the Future",message:"Please Select Start Date/Time that's in the past.",confirmLabel:"Ok",listeners:{confirm:function(){}}})},_startDateIsGTEndDateNotify:function(){console.log("_startDateIsGTEndDateNotify");var me=this;me._startDateIsGTEndDateDialog&&me._startDateIsGTEndDate.destroy(),me._startDateIsGTEndDate=Ext.create("Rally.ui.dialog.ConfirmDialog",{title:"Start Date/Time is greater than End Date/Time",message:"Please Select Start Date/Time that's before End Date/Time",confirmLabel:"Ok",listeners:{confirm:function(){}}})},_hydrateData:function(){console.log("_hydrateData");var me=this;me._artifactChangesetsByChangesetOid={},me._changesetArtifactsByChangesetOid={};var getChangesetsPromise=function(){return me._getChangesets(me)},getChangesetStoriesCollectionPromise=function(){return me._getChangesetArtifactsCollection(me,"UserStory")},getChangesetDefectsCollectionPromise=function(){return me._getChangesetArtifactsCollection(me,"Defect")},getChangesetTasksCollectionPromise=function(){return me._getChangesetArtifactsCollection(me,"Task")},promises=[getChangesetsPromise,getChangesetStoriesCollectionPromise,getChangesetDefectsCollectionPromise,getChangesetTasksCollectionPromise];Deft.Chain.sequence(promises).then({scope:this,success:function(records){me._makeGrids(me)},failure:function(error){deferred.reject("Problem resolving chain "+error)}})},_getChangesets:function(scope){console.log("_getArtifactChangesetCollection");var me=scope,promises=[],deferred=Ext.create("Deft.Deferred");return promises.push(me._hydrateChangesets(me)),Deft.Promise.all(promises).then({success:function(results){var theseChangesets=results[0];Ext.Array.each(theseChangesets,function(changeset){var changesetOID=changeset.get("ObjectID");me._artifactChangesetsByChangesetOid[changesetOID]=changeset}),deferred.resolve([])}}),deferred},_hydrateChangesets:function(scope){var me=scope;console.log("_hydrateChangesetArtifacts");var deferred=Ext.create("Deft.Deferred");return Ext.create("Rally.data.wsapi.Store",{model:"Changeset",autoLoad:!0,fetch:["ObjectID","Name","Revision","CommitTimestamp","Author","Artifacts","Message"],filters:[{property:"CommitTimestamp",operator:">=",value:me._startDateStringUTC},{property:"CommitTimestamp",operator:"<",value:me._endDateStringUTC}],listeners:{load:function(store,records,success){deferred.resolve(records)}}}),deferred},_getHashLength:function(hash){console.log("_getHashLength");var size=0,key;for(key in hash)hash.hasOwnProperty(key)&&size++;return size},_getChangesetArtifactsCollection:function(scope,type){console.log("_getChangesetArtifactsCollection");var me=scope,changesetsByChangesetOID=me._artifactChangesetsByChangesetOid,promises=[],deferred=Ext.create("Deft.Deferred");return me._getHashLength(changesetsByChangesetOID)>0?(Ext.iterate(changesetsByChangesetOID,function(OID,changeset){promises.push(me._hydrateChangesetArtifacts(changeset,type,me))}),Deft.Promise.all(promises).then({success:function(results){deferred.resolve([])}})):deferred.resolve([]),deferred},_hydrateChangesetArtifacts:function(changeset,artifactType,scope){var me=scope;console.log("_hydrateChangesetArtifacts");var deferred=Ext.create("Deft.Deferred"),changesetRef=changeset.get("_ref"),changesetObjectID=changeset.get("ObjectID"),changesetArtifacts=[];return me._changesetArtifactsByChangesetOid[changesetObjectID]&&(changesetArtifacts=me._changesetArtifactsByChangesetOid[changesetObjectID]),Ext.create("Rally.data.wsapi.Store",{model:artifactType,autoLoad:!0,fetch:["Name","FormattedID","ObjectID"],filters:[{property:"Changesets.ObjectID",operator:"=",value:changesetObjectID}],listeners:{load:function(store,records,success){Ext.Array.each(records,function(artifact){changesetArtifacts.push(artifact)}),me._changesetArtifactsByChangesetOid[changesetObjectID]=changesetArtifacts,deferred.resolve([])}}}),deferred},_makeGrids:function(scope){console.log("_makeGrids");var me=scope;me._makeChangesetGrid(me)},_makeChangesetGrid:function(scope){console.log("_makeChangesetGrid");var me=scope;me._changesetGrid&&me._changesetGrid.destroy();var changesets=[];Ext.iterate(me._artifactChangesetsByChangesetOid,function(OID,changeset){var changesetOID=OID,changesetArtifacts=me._changesetArtifactsByChangesetOid[changesetOID]||[],changesetWithArtifacts={_ref:changeset.get("_ref"),ObjectID:changeset.get("ObjectID"),Name:changeset.get("Name"),Revision:changeset.get("Revision"),CommitTimestamp:changeset.get("CommitTimestamp")||"",Message:changeset.get("Message"),Author:changeset.get("Author"),Artifacts:changesetArtifacts};changesets.push(changesetWithArtifacts)});var gridStore=Ext.create("Rally.data.custom.Store",{data:changesets,pageSize:1e3,remoteSort:!1});me._changesetGrid=Ext.create("Rally.ui.grid.Grid",{itemId:"changesetGrid",store:gridStore,columnCfgs:[{text:"Name",dataIndex:"Name",flex:1},{text:"Revision",dataIndex:"Revision"},{text:"Commit Time Stamp",dataIndex:"CommitTimestamp"},{text:"Author",dataIndex:"Author",renderer:function(value){return value?value._refObjectName:void 0}},{text:"Artifacts",dataIndex:"Artifacts",renderer:function(values){var artifactsHtml=[];return Ext.Array.each(values,function(artifact){var artifactObjectID=artifact.get("ObjectID"),artifactFormattedID=artifact.get("FormattedID"),artifactName=artifact.get("Name"),artifactType=artifact.get("_type");"hierarchicalrequirement"===artifactType&&(artifactType="userstory");var artifactLabel=artifactFormattedID+": "+artifactName;artifactsHtml.push('<a href="'+me._rallyServer+"/#/detail/"+artifactType+"/"+artifactObjectID+'">'+artifactLabel+"</a>")}),artifactsHtml.join("<br/> ")},flex:1},{text:"Message",dataIndex:"Message",flex:1},{text:"Move",renderer:function(value,model,record){var id=Ext.id();return Ext.defer(function(){Ext.widget("button",{renderTo:id,text:"Move Changeset",width:120,handler:function(){me._selectSourceArtifactToDisassociate(record.data,me)}})},50),Ext.String.format('<div id="{0}"></div>',id)},flex:1},{text:"Delete",renderer:function(value,model,record){var id=Ext.id();return Ext.defer(function(){Ext.widget("button",{renderTo:id,text:"Delete Changeset",width:120,handler:function(){me._confirmDeleteChangeset(record.data,me)}})},50),Ext.String.format('<div id="{0}"></div>',id)},flex:1}]}),me.down("#gridContainer").add(me._changesetGrid),me._changesetGrid.reconfigure(gridStore)},_selectSourceArtifactToDisassociate:function(changesetrecord,scope){console.log("_selectSourceArtifactToDisassociate");var me=scope,changesetOID=changesetrecord.ObjectID,changesetArtifacts=me._changesetArtifactsByChangesetOid[changesetOID];1===changesetArtifacts.length?(me._selectedArtifact=changesetArtifacts[0],me._selectTargetArtifactForChangesetMove(changesetrecord,scope)):changesetArtifacts?me._sourceArtifactChooserDialog=Ext.create("ChangesetMover.ChooseArtifactDialog",{message:"Select Source Artifact to Dissociate",confirmLabel:"Done",artifactList:changesetArtifacts,listeners:{confirm:function(dialog,sourceartifact){me._selectedArtifact=sourceartifact,me._selectTargetArtifactForChangesetMove(changesetrecord,scope)}}}):me._selectTargetArtifactForChangesetMove(changesetrecord,scope)},_selectTargetArtifactForChangesetMove:function(changesetrecord,scope){console.log("_selectTargetArtifactForChangesetMove");var me=scope;me._targetArtifactChooserDialog=Ext.create("Rally.ui.dialog.ChooserDialog",{artifactTypes:["UserStory","Defect","Task"],autoShow:!0,height:600,title:"Choose Target Artifact to Receive Changeset",listeners:{artifactChosen:function(targetartifact){me._createMoveChangesetAttributesDialog(changesetrecord,targetartifact,scope)},scope:this}})},_createMoveChangesetAttributesDialog:function(sourcechangeset,targetartifact,scope){console.log("_createMoveChangesetAttributesDialog");var me=scope,message="Define Updated Changeset Attributes",confirmLabel="Move Changeset",currentCommitMessage=sourcechangeset.Message||"";me._moveChangesetAttributesDialog=Ext.create("ArtifactChangesetHelper.ChangesetNewAttribsDialog",{message:message,targetFormattedID:targetartifact.get("FormattedID"),currentCommitMessage:currentCommitMessage,confirmLabel:confirmLabel,listeners:{confirm:function(dialog,newcommitmessage){me._moveChangeset(sourcechangeset,targetartifact,newcommitmessage,scope)}}})},_moveChangeset:function(sourcechangeset,targetartifact,newcommitmessage,scope){console.log("_moveChangeset");var me=scope,changesetOID=sourcechangeset.ObjectID,changesetModel=Rally.data.ModelFactory.getModel({type:"Changeset",scope:this,success:function(model,operation){model.load(changesetOID,{scope:this,success:function(changesetHydrated,operation){var existingArtifactRefs=[],updatedArtifactRefs=[];if(me._selectedArtifact){var sourceArtifact=me._selectedArtifact,sourceArtifactRef=sourceArtifact.get("_ref"),existingArtifacts=me._changesetArtifactsByChangesetOid[changesetOID];Ext.Array.each(existingArtifacts,function(artifact){existingArtifactRefs.push(artifact.get("_ref"))}),updatedArtifactRefs=existingArtifactRefs;var index=updatedArtifactRefs.indexOf(sourceArtifactRef);index>-1&&updatedArtifactRefs.splice(index,1)}updatedArtifactRefs.push(targetartifact.get("_ref"));var updatedArtifactsArray=_.map(updatedArtifactRefs,function(ref){return{_ref:ref}});changesetHydrated.set("Artifacts",updatedArtifactsArray),changesetHydrated.set("Message",newcommitmessage),changesetHydrated.save({callback:function(result,operation){if(operation.wasSuccessful()){Ext.defer(function(){delete me._artifactChangesetsByChangesetOid[changesetOID]},100);var successMessage="Changeset Successfully Moved To: "+targetartifact.get("FormattedID");Ext.create("Rally.ui.dialog.ConfirmDialog",{title:"Changeset Moved",message:successMessage,confirmLabel:"Ok",listeners:{confirm:function(){Ext.defer(function(){me._changesetGrid&&(me._changesetGrid.destroy(),me._makeChangesetGrid(me))},500)}}})}else Ext.create("Rally.ui.dialog.ConfirmDialog",{title:"Changeset Not Moved",message:"Error Moving Changeset!",confirmLabel:"Ok",listeners:{confirm:function(){}}})}})}})}})},_confirmDeleteChangeset:function(record,scope){console.log("_confirmDeleteChangeset");var me=scope,confirmLabel="Delete Changeset Permanently",message="Really Delete Changeset? Deleted Changeset cannot be recovered.";Ext.create("Rally.ui.dialog.ConfirmDialog",{message:message,confirmLabel:confirmLabel,listeners:{confirm:function(){me._deleteChangeset(record,scope)}}})},_deleteChangeset:function(record,scope){console.log("_deleteChangeset");var me=scope,changesetOID=record.ObjectID,changesetModel=Rally.data.ModelFactory.getModel({type:"Changeset",scope:this,success:function(model,operation){model.load(changesetOID,{scope:this,success:function(changesetHydrated,operation){changesetHydrated.destroy({callback:function(result,operation){operation.wasSuccessful()?(Ext.defer(function(){delete me._artifactChangesetsByChangesetOid[changesetOID]},100),Ext.create("Rally.ui.dialog.ConfirmDialog",{title:"Changeset Deleted",message:"Changeset Successfully Removed!",confirmLabel:"Ok",listeners:{confirm:function(){Ext.defer(function(){me._changesetGrid&&(me._changesetGrid.destroy(),me._makeChangesetGrid(me))},500)}}})):Ext.create("Rally.ui.dialog.ConfirmDialog",{title:"Changeset Not Removed",message:"Error Removing Changeset!",confirmLabel:"Ok",listeners:{confirm:function(){}}})}})}})}})}});
                Ext.define("ArtifactChangesetHelper.ChangesetNewAttribsDialog",{extend:"Rally.ui.dialog.Dialog",alias:"widget.newchangesetattributes",requires:["Rally.ui.Button","Rally.ui.dialog.Dialog","Rally.ui.TextField"],clientMetrics:{beginEvent:"beforeshow",endEvent:"show",description:"dialog shown"},width:350,closable:!0,autoShow:!0,cls:"rally-confirm-dialog",title:"",message:"",showRevisionField:!1,currentCommitMessage:"",targetFormattedID:"",confirmLabel:"Continue",cancelLabel:"Cancel",_scmRepositoriesCombobox:null,_selectedSCMRepo:null,items:[{xtype:"component",itemId:"confirmMsg",cls:"confirmMessage"},{xtype:"rallytextfield",fieldLabel:"Target FormattedID:",itemId:"targetFmtId",cls:"targetFormattedID"},{xtype:"rallytextfield",fieldLabel:"Current Commit Message:",itemId:"currentCommitMsg",cls:"currentCommitMessage"},{xtype:"rallytextfield",fieldLabel:"Revision:",itemId:"revisionNbr"},{xtype:"container",itemId:"scmReposContainer"},{xtype:"rallytextfield",fieldLabel:"New Commit Message:",itemId:"newCommitMsg"}],dockedItems:[{xtype:"toolbar",dock:"bottom",padding:"10",layout:{type:"hbox",pack:"center"},ui:"footer",items:[{xtype:"rallybutton",cls:"confirm primary small",itemId:"confirmButton",userAction:"clicked yes in dialog"},{xtype:"rallybutton",cls:"cancel secondary small",itemId:"cancelButton",ui:"link"}]}],constructor:function(config){this.callParent(arguments),this.autoCenter&&(this.scrollListener.saveScrollPosition=!0),config.currentCommitMessage&&(this.currentCommitMessage=config.currentCommitMessage),config.targetFormattedID&&(this.targetFormattedID=config.targetFormattedID),config.showRevisionField&&(this.showRevisionField=config.showRevisionField),config.scmRepositories&&(this.scmRepositories=config.scmRepositories)},initComponent:function(){if(this.callParent(arguments),this.addEvents("confirm","cancel"),this.down("#confirmButton").on("click",this._onConfirm,this),this.down("#confirmButton").setText(this.confirmLabel),this.down("#cancelButton").on("click",this._onCancel,this),this.down("#cancelButton").setText(this.cancelLabel),this.message?this.down("#confirmMsg").update(this.message):this.down("#confirmMsg").hide(),this.currentCommitMessage?(this.down("#currentCommitMsg").setValue(this.currentCommitMessage),this.down("#currentCommitMsg").setDisabled(!0)):this.down("#currentCommitMsg").hide(),this.targetFormattedID?(this.down("#targetFmtId").setValue(this.targetFormattedID),this.down("#targetFmtId").setDisabled(!0)):this.down("#targetFmtId").hide(),this.showRevisionField||this.down("#revisionNbr").hide(),this.scmRepositories){var me=this,scmReposData=[];Ext.Array.each(this.scmRepositories,function(scmrepository){scmReposData.push({name:scmrepository.get("Name"),_ref:scmrepository.get("_ref")})});var scmReposStore=Ext.create("Ext.data.Store",{fields:["name","_ref"],data:scmReposData});me._scmRepositoriesCombobox=Ext.create("Ext.form.ComboBox",{fieldLabel:"Choose SCM Repo:",store:scmReposStore,queryMode:"local",displayField:"name",valueField:"type",minWidth:500,listeners:{scope:this,select:me._selectSCMRepo}}),this.down("#scmReposContainer").add(me._scmRepositoriesCombobox)}},_selectSCMRepo:function(combobox,records){var me=this;me._selectedSCMRepo=records[0]},show:function(){this.autoCenter&&this._saveScrollPosition(),this.callParent(arguments)},close:function(){this._onCancel()},_onConfirm:function(){this._scmRepositoriesCombobox?this.fireEvent("confirm",this,this.down("#newCommitMsg").getValue(),this.down("#revisionNbr").getValue(),this._selectedSCMRepo):this.fireEvent("confirm",this,this.down("#newCommitMsg").getValue(),this.down("#revisionNbr").getValue()),this.destroy()},_onCancel:function(){this.fireEvent("cancel",this),this.destroy()},_saveScrollPosition:function(){this.savedScrollPosition={xOffset:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,yOffset:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}}});
                Ext.define("ChangesetMover.ChooseDateDialog",{extend:"Rally.ui.dialog.Dialog",alias:"widget.choosedate",requires:["Rally.ui.Button","Rally.ui.dialog.Dialog","Rally.ui.TextField"],clientMetrics:{beginEvent:"beforeshow",endEvent:"show",description:"dialog shown"},width:350,closable:!0,autoShow:!0,cls:"rally-confirm-dialog",title:"",message:"",confirmLabel:"Continue",cancelLabel:"Cancel",defaultDate:null,selectedDate:null,calendar:null,items:[{xtype:"component",itemId:"confirmMsg",cls:"confirmMessage"},{xtype:"container",itemId:"calendarContainer"}],dockedItems:[{xtype:"toolbar",dock:"bottom",padding:"10",layout:{type:"hbox",pack:"center"},ui:"footer",items:[{xtype:"rallybutton",cls:"confirm primary small",itemId:"confirmButton",userAction:"clicked yes in dialog"},{xtype:"rallybutton",cls:"cancel secondary small",itemId:"cancelButton",ui:"link"}]}],constructor:function(config){this.callParent(arguments),this.autoCenter&&(this.scrollListener.saveScrollPosition=!0),this.defaultDate=new Date,config.defaultDate&&(this.defaultDate=config.defaultDate),this.selectedDate=this.defaultDate,config.calendarLabel&&(this.calendarLabel=config.calendarLabel),config.maxDate&&(this.maxDate=config.maxDate)},initComponent:function(){var me=this;this.callParent(arguments),this.addEvents("confirm","cancel"),this.down("#confirmButton").on("click",this._onConfirm,this),this.down("#confirmButton").setText(this.confirmLabel),this.down("#cancelButton").on("click",this._onCancel,this),this.down("#cancelButton").setText(this.cancelLabel),this.message?this.down("#confirmMsg").update(this.message):this.down("#confirmMsg").hide();var calendarLabel="Choose a date:";this.calendarLabel&&(calendarLabel=this.calendarLabel);var calendarConfig={title:calendarLabel,width:200,bodyPadding:10,renderTo:Ext.getBody(),items:[{xtype:"datepicker",handler:function(picker,date){console.log(date),me.selectedDate=date}}]};this.maxDate&&(calendarConfig.maxDate=this.maxDate),this.calendar=Ext.create("Ext.panel.Panel",calendarConfig),this.down("#calendarContainer").add(this.calendar)},show:function(){this.autoCenter&&this._saveScrollPosition(),this.callParent(arguments)},close:function(){this._onCancel()},_onConfirm:function(){this.fireEvent("confirm",this,this.selectedDate),this.destroy()},_onCancel:function(){this.fireEvent("cancel",this),this.destroy()},_saveScrollPosition:function(){this.savedScrollPosition={xOffset:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,yOffset:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}}});
                Ext.define("ChangesetMover.ChooseArtifactDialog",{extend:"Rally.ui.dialog.Dialog",alias:"widget.chooseartifact",requires:["Rally.ui.Button","Rally.ui.dialog.Dialog","Rally.ui.TextField"],clientMetrics:{beginEvent:"beforeshow",endEvent:"show",description:"dialog shown"},width:350,closable:!0,autoShow:!0,cls:"rally-confirm-dialog",title:"",message:"",confirmLabel:"Continue",cancelLabel:"Cancel",artifactList:null,selectedArtifact:null,artifactStore:null,artifactComboBox:null,items:[{xtype:"component",itemId:"confirmMsg",cls:"confirmMessage"},{xtype:"container",itemId:"artifactComboboxContainer"}],dockedItems:[{xtype:"toolbar",dock:"bottom",padding:"10",layout:{type:"hbox",pack:"center"},ui:"footer",items:[{xtype:"rallybutton",cls:"confirm primary small",itemId:"confirmButton",userAction:"clicked yes in dialog"},{xtype:"rallybutton",cls:"cancel secondary small",itemId:"cancelButton",ui:"link"}]}],constructor:function(config){this.callParent(arguments),this.autoCenter&&(this.scrollListener.saveScrollPosition=!0),this.artifactList=config.artifactList},initComponent:function(){var me=this;this.callParent(arguments),this.addEvents("confirm","cancel");var artifactRecords=[];Ext.Array.each(this.artifactList,function(artifact){var artifactRecord={name:artifact.get("FormattedID")+": "+artifact.get("Name"),value:artifact};artifactRecords.push(artifactRecord)}),this.artifactStore=Ext.create("Ext.data.Store",{fields:["name","value"],data:artifactRecords}),this.artifactComboBox=Ext.create("Ext.form.ComboBox",{fieldLabel:"Choose Artifact",store:this.artifactStore,queryMode:"local",displayField:"name",valueField:"type",listeners:{scope:this,select:function(combobox,records){this.selectedArtifact=records[0].get("value"),console.log(this.selectedArtifact)}}}),this.down("#confirmButton").on("click",this._onConfirm,this),this.down("#confirmButton").setText(this.confirmLabel),this.down("#cancelButton").on("click",this._onCancel,this),this.down("#cancelButton").setText(this.cancelLabel),this.message?this.down("#confirmMsg").update(this.message):this.down("#confirmMsg").hide(),this.down("#artifactComboboxContainer").add(this.artifactComboBox)},show:function(){this.autoCenter&&this._saveScrollPosition(),this.callParent(arguments)},close:function(){this._onCancel()},_onConfirm:function(){this.fireEvent("confirm",this,this.selectedArtifact),this.destroy()},_onCancel:function(){this.fireEvent("cancel",this),this.destroy()},_saveScrollPosition:function(){this.savedScrollPosition={xOffset:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,yOffset:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}}});

            Rally.launchApp('ChangesetMover', {
                name:"Changeset Mover",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app {
     /* Add app styles here */
}

    </style>
</head>
<body></body>
</html>
